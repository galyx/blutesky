function activeSortableRelList(){$(".rel-list").each((function(){var list_id=$(this).closest(".rel-btn").data("list_id");$(".rel-list-"+list_id).sortable({axis:"y",cursor:"move",placeholder:"ui-state-highlight",connectWith:".rel-list",beforeStop:function(event,ui){var tag=$(ui.item[0]),positions=[];tag.closest(".rel-list").find(".item-rel-btn").each((function(index){positions.push({task_id:$(this).data("task_id"),list_id:$(this).closest(".rel-btn").data("list_id"),position:index+1})})),$.ajax({url:taskUpdate,type:"POST",data:{positions:positions,task_update_position:!0},success:data=>{}})}}).disableSelection()}))}$(document).ready((function(){$("#select_color").colpick({onChange:response=>{var colorHex=$.colpick.hsbToHex(response);$("#select_color").css("background-color","#"+colorHex).attr("data-colorHex","#"+colorHex)},onSubmit:response=>{$("#select_color").colpickHide()}}),$("#select_color_edit").colpick({onChange:response=>{var colorHex=$.colpick.hsbToHex(response);$("#select_color_edit").css("background-color","#"+colorHex).attr("data-colorHex","#"+colorHex)},onSubmit:response=>{$("#select_color_edit").colpickHide()}}),$(document).on("click",'[data-toggle="collapse"]',(function(){"true"==$(this).attr("aria-expanded")?$(this).find(".btn-info-rel").html('<i class="ri-subtract-fill"></i>'):$(this).find(".btn-info-rel").html('<i class="ri-add-fill"></i>')})),$(document).on("click",'[data-target="#modalUserAssoc"]',(function(){$("#modalUserAssoc").find(".user-assoc-select").empty();var users=$(this).data("users");for(i in users)$("#modalUserAssoc").find(".user-assoc-select").append(`\n                <div class="row rounded border py-2 mb-2 user-select" style="cursor: pointer;" id="user_assoc_id-${users[i].id}" data-dados='${JSON.stringify(users[i])}'>\n                    <div class="col-4 text-center">\n                        <img style="border-radius: 50%;width: 40%;" src="https://ui-avatars.com/api/?name=${users[i].name.replace(" ","+")}&color=ffffff&background=5866db" alt="">\n                    </div>\n                    <div class="col-8">\n                        ${users[i].name}\n                    </div>\n                </div>\n            `)})),$(document).on("keyup",".add-list-name",(function(e){if(e.preventDefault(),13==e.keyCode){if($(this).val().includes(";"))for(var separator=$(this).val().split(";"),i=0;separator.length>i;i++)separator[i]&&$('[aria-labelledby="dropdownlist"]').append('<div class="px-2 py-1" style="position: relative;"><input type="hidden" name="list_name[]" value="'+separator[i]+'">'+separator[i]+' <button type="button" class="btn close btn-remove-list" style="position: absolute; right: 8px; top: 1px">x</button></div>');else $('[aria-labelledby="dropdownlist"]').append('<div class="px-2 py-1" style="position: relative;"><input type="hidden" name="list_name[]" value="'+$(this).val()+'">'+$(this).val()+' <button type="button" class="btn close btn-remove-list" style="position: absolute; right: 8px; top: 1px">x</button></div>');$(this).val("")}})),$(document).on("click",".btn-remove-list",(function(){$(this).parent().remove()})),$(document).on("change",'[name="field_type"]',(function(){switch($('[name="date_mask"], [name="date_time_mask"], [name="moeda_mask"], .add-list').parent().addClass("d-none"),$(this).val()){case"date":$('[name="date_mask"]').parent().removeClass("d-none");break;case"date_time":$('[name="date_time_mask"]').parent().removeClass("d-none");break;case"moeda":$('[name="moeda_mask"]').parent().removeClass("d-none");break;case"checkbox":case"select":case"radio":$(".add-list").parent().removeClass("d-none")}})),$(document).on("click",".user-select",(function(){var data=$(this).data("dados"),div_user=$(".div-user-assoc").find(".user-assoc");0==div_user.find(`#user_assoc_id-${data.id}`).length?div_user.append(`\n                <div class="mb-1 mx-1" style="border-radius: 50%;width: 10%;" id="user_assoc_id-${data.id}">\n                    <input type="hidden" name="user_assoc_id[]" value="${data.id}">\n                    <img style="border-radius: 50%;width: 100%;" src="https://ui-avatars.com/api/?name=${data.name.replace(" ","+")}&color=ffffff&background=5866db" alt="">\n                </div>\n            `):div_user.find(`#user_assoc_id-${data.id}`).remove(),$('[data-toggle="tooltip"]').tooltip()})),$(document).on("click",".tag-select",(function(){var data=$(this).data("dados"),div_tag=$(".div-tags").find(".tags");0==div_tag.find(`#tag_id-${data.id}`).length?div_tag.append(`\n                <div class="col mb-1 px-1" id="tag_id-${data.id}">\n                    <input type="hidden" name="tag_id[]" value="${data.id}">\n                    <div class="w-100 py-2 px-1 rounded text-truncate" title="${data.tag_name?data.tag_name:""}" data-toggle="tooltip" style="background-color: ${data.tag_color}; min-height: 40px;cursor: pointer;">${data.tag_name?data.tag_name:""}</div>\n                </div>\n            `):div_tag.find(`#tag_id-${data.id}`).remove(),$('[data-toggle="tooltip"]').tooltip()})),$(document).on("click",".btn-save-new-tag",(function(){$(this).prop("disabled",!0),$(".btn-cancel-new-tag").prop("disabled",!0),$.ajax({url:newTag,type:"POST",data:{tag_name:$(".new-tag-name").val(),tag_color:$("#select_color").attr("data-colorHex"),job_id:$("select.select-job").val()},success:data=>{console.log(data),$(".m-new-tag").addClass("d-none"),$(".btn-new-tag").removeClass("d-none").prop("disabled",!1),$(".btn-cancel-new-tag").prop("disabled",!1),$(".btn-save-new-tag").prop("disabled",!1),$(".new-tag-name").val(""),$("#select_color").attr("data-colorHex","#ffffff").css("background-color","#ffffff"),$(".tags-select").append(`\n                    <div class="col-12 d-flex mb-1">\n                        <div class="w-75 py-2 px-1 rounded text-truncate tag-select" title="${data.tag_name?data.tag_name:""}" data-toggle="tooltip" style="background-color: ${data.tag_color}; min-height: 40px;cursor: pointer;" data-dados='${JSON.stringify(data)}'>${data.tag_name}</div>\n                        <div class="col">\n                            <button type="button" class="btn btn-block border btn-edit-tag-select" data-select="false" data-dados='${JSON.stringify(data)}'><i class="ri-pencil-fill"></i></button>\n                        </div>\n                    </div>\n                `)}})})),$(document).on("click",".btn-save-edit-tag",(function(){$(this).prop("disabled",!0),$(".btn-cancel-new-tag").prop("disabled",!0),$(".btn-delete-edit-tag").prop("disabled",!0),$.ajax({url:newTag,type:"POST",data:{tag_id:$('[data-select="true"]').data("dados").id,tag_name:$(".edit-tag-name").val(),tag_color:$("#select_color_edit").attr("data-colorHex"),job_id:$("select.select-job").val()},success:data=>{console.log(data),$(".m-edit-tag").addClass("d-none"),$(".btn-new-tag").removeClass("d-none").prop("disabled",!1),$(".btn-save-edit-tag").prop("disabled",!1),$(".btn-cancel-new-tag").prop("disabled",!1),$(".btn-delete-edit-tag").prop("disabled",!1),$(".edit-tag-name").val(""),$("#select_color_edit").attr("data-colorHex","#ffffff").css("background-color","#ffffff"),$('[data-select="true"]').closest(".col-12").remove(),$(".tags-select").append(`\n                    <div class="col-12 d-flex mb-1">\n                        <div class="w-75 py-2 px-1 rounded text-truncate tag-select" title="${data.tag_name?data.tag_name:""}" data-toggle="tooltip" style="background-color: ${data.tag_color}; min-height: 40px; cursor: pointer;">${data.tag_name}</div>\n                        <div class="col">\n                            <button type="button" class="btn btn-block border btn-edit-tag-select" data-select="false" data-dados='${JSON.stringify(data)}'><i class="ri-pencil-fill"></i></button>\n                        </div>\n                    </div>\n                `),$(".btn-edit-tag-select").attr("data-select","false")}})})),$(document).on("click",".btn-delete-edit-tag",(function(){$(this).prop("disabled",!0),$(".btn-cancel-new-tag").prop("disabled",!0),$(".btn-save-edit-tag").prop("disabled",!0),Swal.fire({icon:"error",title:"Você está preste a apagar essa etiqueta, tem certeza?",text:"Todos registro vinculados a essa etiqueta serão desvinculados permanentemente.",showCancelButton:!0,confirmButtonText:"Sim Apagar",cancelButtonText:"Cancelar",focusConfirm:!1}).then(result=>{result.isConfirmed&&$.ajax({url:deleteTag,type:"POST",data:{tag_id:$('[data-select="true"]').data("dados").id,job_id:$("select.select-job").val()},success:data=>{console.log(data),$(".m-edit-tag").addClass("d-none"),$(".btn-new-tag").removeClass("d-none").prop("disabled",!1),$(".btn-save-edit-tag").prop("disabled",!1),$(".btn-cancel-new-tag").prop("disabled",!1),$(".btn-delete-edit-tag").prop("disabled",!1),$(".edit-tag-name").val(""),$("#select_color_edit").attr("data-colorHex","#ffffff").css("background-color","#ffffff"),$('[data-select="true"]').closest(".col-12").remove(),$(".btn-edit-tag-select").attr("data-select","false")}})})})),$(document).on("click",".btn-new-tag",(function(){$(this).addClass("d-none"),$(".m-new-tag").removeClass("d-none")})),$(document).on("click",".btn-cancel-new-tag",(function(){$(".btn-edit-tag-select").attr("data-select","false"),$(".m-new-tag").addClass("d-none"),$(".m-edit-tag").addClass("d-none"),$(".btn-new-tag").removeClass("d-none"),$(".new-tag-name, .edit-tag-name").val(""),$("#select_color, #select_color_edit").attr("data-colorHex","#ffffff").css("background-color","#ffffff")})),$(document).on("click",".btn-edit-tag-select",(function(){var data=$(this).data("dados");$(this).attr("data-select","true"),$(".m-new-tag").addClass("d-none"),$(".m-edit-tag").removeClass("d-none"),$(".btn-new-tag").addClass("d-none"),console.log(data),$(".edit-tag-name").val(data.tag_name),$("#select_color_edit").attr("data-colorHex",data.tag_color).css("background-color",data.tag_color)})),$(document).on("click",".btn-edit-custom-field",(function(){$("#modalField").find(".btn-detroy-field-custom").removeClass("d-none"),$.each($(this).data("dados"),(key,value)=>{"job_id"!==key&&$("#formModalField").find(`[name="${key}"]`).val(value),"field_required"==key&&$("#formModalField").find('[name="field_required"]').prop("checked",1==value),"field_edit_lists"==key&&$("#formModalField").find('[name="field_edit_lists"]').prop("checked",1==value),$("#formModalField").find("select").trigger("change")})})),$(document).on("click",".btn-detroy-field-custom",(function(){Swal.fire({icon:"error",title:"Você está preste a apagar esse campo, tem certeza?",text:"Será apagado permanentemente.",showCancelButton:!0,confirmButtonText:"Sim Apagar",cancelButtonText:"Cancelar",focusConfirm:!1}).then(result=>{result.isConfirmed&&(Swal.fire({title:"Apagando campo, aguarde...",allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{Swal.showLoading()}}),$.ajax({url:"/delete-field",type:"POST",data:{job_id:$("#formModalField").find('[name="job_id"]').val(),list_id:$("#formModalField").find('[name="list_id"]').val(),label_field_id:$("#formModalField").find('[name="label_field_id"]').val()},success:data=>{Swal.fire({icon:"success",title:"Campo apagado com sucesso!"}).then(()=>{$("#formModalField").closest(".modal").modal("hide"),$(".custom-fields").find("#custom_field_id-"+$("#formModalField").find('[name="label_field_id"]').val()).remove()})}}))})})),$(document).on("click",".item-rel-btn",(function(){var url_insert=`/job/${$("select.select-job").val()}/${$(this).closest(".rel-btn").data("list_id")}/${$(this).data("task_id")}`;window.history.pushState({url:url_insert},$("title").text(),url_insert),Swal.fire({title:"Carregando informações...",allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{Swal.showLoading()}}),$.ajax({url:"/search-controller",type:"POST",data:{request_swicth:"request-task-modal",job_id:$("select.select-job").val(),list_id:$(this).closest(".rel-btn").data("list_id"),task_id:$(this).data("task_id")},success:data=>{Swal.close(),$("#modalTask").find(".modal-task").html(data.html),$("#modalTask").modal("show"),$(".selectpicker").selectpicker(),$(".date-mask-single").daterangepicker(dateMaskSingle),fieldMask(),sortableFieldCustom(),setTimeout(()=>{var modal_body=$("#modalTask").find(".modal-body").height(),task_titleH=$("#modalTask").find(".task_title").innerHeight(),task_titleM=parseFloat($("#modalTask").find(".task_title").css("margin-bottom"))||0;$("#modalTask").find(".task-card").css("max-height",modal_body-task_titleH-task_titleM-8+"px")},10)},error:err=>{Swal.fire({icon:"error",title:"Houve um erro na consulta, contate o administrador!"})}})})),$(document).on("click",'[data-target="#modalField"]',(function(){$("#formModalField").find('[name="list_id"]').val($(this).closest("form").find('[name="list_id"]').val())})),$(".rel").sortable({axis:"y",placeholder:"ui-state-highlight",cursor:"move",beforeStop:function(event,ui){var positions=[];$(".rel .rel-btn").each((function(index){positions.push({list_id:$(this).attr("data-list_id"),position:index+1})})),$.ajax({url:listUpdate,type:"POST",data:{positions:positions},success:data=>{}})},activate:function(event,ui){$(".rel").sortable("refresh"),$(".rel").find(".header-rel").addClass("collapsed"),$(".rel").find(".collapse").removeClass("show"),$(".rel").find(".btn-info-rel").html('<i class="ri-add-fill"></i>')},containment:"document"}).disableSelection(),activeSortableRelList(),$("#modalTags").on("hidden.bs.modal",(function(){$(".btn-edit-tag-select").attr("data-select","false"),$(".m-new-tag").addClass("d-none"),$(".m-edit-tag").addClass("d-none"),$(".btn-new-tag").removeClass("d-none"),$(".new-tag-name, .edit-tag-name").val(""),$("#select_color, #select_color_edit").attr("data-colorHex","#ffffff").css("background-color","#ffffff")})),$("#modalField").on("hidden.bs.modal",(function(){$("#formModalField").find('[name="date_mask"], [name="date_time_mask"], [name="moeda_mask"], .add-list').parent().addClass("d-none"),$("#formModalField").find('input[type="text"], select').val(""),$("#formModalField").find('[aria-labelledby="dropdownlist"]').empty(),$("#formModalField").find('[name="field_type"]').val("text"),$("#formModalField").find('[name="list_id"]').val(""),$("#formModalField").find('[name="label_field_id"]').val(""),$("#formModalField").find('[name="field_required"]').prop("checked",!1),$("#formModalField").find('[name="field_edit_lists"]').prop("checked",!0),$("#modalField").find(".btn-detroy-field-custom").addClass("d-none")})),$("#modalTask").on("hidden.bs.modal",(function(){var url_insert=`/job/${$("select.select-job").val()}`;window.history.pushState({url:url_insert},$("title").text(),url_insert)}))}));